/*! tus-js-client - v2.3.1
 * https://github.com/tus/tus-js-client
 * Copyright (c) 2019 Transloadit GmbH
 * Licensed under the MIT license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).tus=t()}(this,function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r="function"==typeof Promise?Promise:function(){function e(e){this.status="pending",this.value=void 0,this.reason=void 0,this.onFulfilledCallbacks=[],this.onRejectedCallbacks=[],this.resolve=function(e){this.status="fulfilled",this.value=e,this.onFulfilledCallbacks.forEach(function(t){t(e)})}.bind(this),this.reject=function(e){this.status="rejected",this.reason=e,this.onRejectedCallbacks.forEach(function(t){t(e)})}.bind(this);try{e(this.resolve,this.reject)}catch(e){this.reject(e)}}return e.prototype.then=function(t,n){var r=this;return new e(function(e,i){r.onFulfilledCallbacks.push(function(n){try{if("function"==typeof t){var r=t(n);e(r)}else e(n)}catch(e){i(e)}}),r.onRejectedCallbacks.push(function(t){if("function"==typeof n)try{var r=n(t);e(r)}catch(e){i(e)}else i(t)})})},e}();function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var i=f(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var p=function(){function e(t,n){var r=n.url,i=n.method,o=n.headers,s=n.body,a=n.withCredentials,u=n.responseType,c=n.timeout,l=n.onSuccess,h=n.onError,f=n.onProgress;if(o(this,e),this.url=r,this.method=i,this.headers=o||{},this.body=s,this.withCredentials=a||!1,this.responseType=u||"text",this.timeout=c||0,this.onSuccess=l,this.onError=h,this.onProgress=f,this.xhr=new XMLHttpRequest,this.xhr.open(this.method,this.url,!0),this.xhr.withCredentials=this.withCredentials,this.xhr.responseType=this.responseType,this.xhr.upload&&this.onProgress&&this.xhr.upload.addEventListener("progress",function(e){e.lengthComputable&&f(e.loaded,e.total)}),this.xhr.addEventListener("load",function(){if(this.xhr.status>=200&&this.xhr.status<300){var e=this.xhr.response;l&&l(this.xhr.getResponseHeader("Location"),e)}else{var t=new Error("tus: unexpected response while creating upload, code "+this.xhr.status);h&&h(t)}}.bind(this)),this.xhr.addEventListener("error",function(){var e=new Error("tus: failed to create upload");h&&h(e)}.bind(this)),this.timeout>0){var d=setTimeout(function(){this.xhr.abort();var e=new Error("tus: request timed out");h&&h(e)}.bind(this),this.timeout);this.xhr.addEventListener("load",function(){clearTimeout(d)}.bind(this)),this.xhr.addEventListener("error",function(){clearTimeout(d)}.bind(this))}for(var p in this.headers)this.xhr.setRequestHeader(p,this.headers[p]);this.xhr.send(this.body)}return e.prototype.create=function(){return this.xhr.send(),this.xhr},e}(),y=function(){function e(t){var n=t.url,r=t.retryDelays,i=t.minChunkSize,o=t.parallelUploads,s=t.storeFingerprintForResuming,a=t.removeFingerprintOnSuccess,u=t.uploadLengthDeferred,c=t.uploadSize,l=t.onProgress,h=t.onChunkComplete,f=t.onError,d=t.onSuccess,y=t.metadata,m=t.overridePatchMethod,g=t.headers,v=t.uploadUrlDuringCreation;if(o(this,e),this.url=n,this.retryDelays=r||[0,1e3,3e3,5e3],this.minChunkSize=i||100,this.parallelUploads=o||1,this.storeFingerprintForResuming=s||!1,this.removeFingerprintOnSuccess=a||!1,this.uploadLengthDeferred=u||!1,this.uploadSize=c,this.onProgress=l,this.onChunkComplete=h,this.onError=f,this.onSuccess=d,this.metadata=y||{},this.overridePatchMethod=m||!1,this.headers=g||{},this.uploadUrlDuringCreation=v||!1,this.fingerprint=null,this.urlStorage=null,this._xhr=null,this._retryCount=0,this._shouldRetry=!0}var t,n,i;return t=e,(n=[{key:"start",value:function(){var e=this;return this._aborted?Promise.reject(new Error("tus: upload has already been stopped")):this.url?Promise.resolve(this.url):this._createUpload().then(function(t){return e.url=t,e._resumeUpload()})}},{key:"abort",value:function(){var e=this;return this._aborted=!0,this._xhr&&(this._xhr.abort(),this._xhr=null),Promise.resolve()}},{key:"_createUpload",value:function(){var e=this;return this._aborted?Promise.reject(new Error("tus: upload has already been stopped")):new Promise(function(t,n){var r=new p({url:e.url,method:"POST",headers:e._headers(),withCredentials:e._withCredentials,timeout:e.options.timeout,onSuccess:function(n){t(n)},onError:function(e){n(e)}});r.create()})}},{key:"_resumeUpload",value:function(){var e=this;if(this._aborted)return Promise.reject(new Error("tus: upload has already been stopped"));var t=this._offset;if(t>=this.uploadSize)return this._emitSuccess(),Promise.resolve();var n=this._headers();return new Promise(function(r,i){e._xhr=new p({url:e.url,method:"PATCH",headers:n,withCredentials:e._withCredentials,timeout:e.options.timeout,onSuccess:function(){e._emitChunkComplete(t,e.uploadSize),e._offset=e.uploadSize,e._emitSuccess(),r()},onError:function(t){e._emitError(t),i(t)},onProgress:function(n,r){e._emitProgress(n,r)}}),e._xhr.create()})}},{key:"_headers",value:function(){var e=this.headers;return this.uploadLengthDeferred||(e["Upload-Length"]=this.uploadSize),e["Upload-Offset"]=this._offset,e["Tus-Resumable"]="1.0.0",this.metadata&&(e["Upload-Metadata"]=this._encodeMetadata()),e}},{key:"_encodeMetadata",value:function(){var e=this;return Object.keys(this.metadata).map(function(t){return t+" "+btoa(e.metadata[t])}).join(",")}},{key:"_emitProgress",value:function(e,t){this.onProgress&&this.onProgress(e,t)}},{key:"_emitChunkComplete",value:function(e,t){this.onChunkComplete&&this.onChunkComplete(e,t)}},{key:"_emitSuccess",value:function(){this.onSuccess&&this.onSuccess()}},{key:"_emitError",value:function(e){this.onError&&this.onError(e)}},{key:"_offset",get:function(){return this._offset||0}}])&&s(t.prototype,n),i&&s(t,i),e}();return function(){function e(t){var n=t.endpoint,r=t.retryDelays,i=t.minChunkSize,o=t.parallelUploads,s=t.storeFingerprintForResuming,a=t.removeFingerprintOnSuccess,u=t.uploadLengthDeferred,c=t.uploadSize,l=t.onProgress,h=t.onChunkComplete,f=t.onError,d=t.onSuccess,p=t.metadata,y=t.overridePatchMethod,m=t.headers,g=t.uploadUrlDuringCreation;if(o(this,e),this.endpoint=n,this.retryDelays=r||[0,1e3,3e3,5e3],this.minChunkSize=i||100,this.parallelUploads=o||1,this.storeFingerprintForResuming=s||!1,this.removeFingerprintOnSuccess=a||!1,this.uploadLengthDeferred=u||!1,this.uploadSize=c,this.onProgress=l,this.onChunkComplete=h,this.onError=f,this.onSuccess=d,this.metadata=p||{},this.overridePatchMethod=y||!1,this.headers=m||{},this.uploadUrlDuringCreation=g||!1,this._upload=null,this._retryCount=0,this._shouldRetry=!0}var t,n,i;return t=e,(n=[{key:"start",value:function(){var e=this;return this._upload=new y({url:this.endpoint,retryDelays:this.retryDelays,minChunkSize:this.minChunkSize,parallelUploads:this.parallelUploads,storeFingerprintForResuming:this.storeFingerprintForResuming,removeFingerprintOnSuccess:this.removeFingerprintOnSuccess,uploadLengthDeferred:this.uploadLengthDeferred,uploadSize:this.uploadSize,onProgress:this.onProgress,onChunkComplete:this.onChunkComplete,onError:function(t){e._handleError(t)},onSuccess:function(){e._handleSuccess()},metadata:this.metadata,overridePatchMethod:this.overridePatchMethod,headers:this.headers,uploadUrlDuringCreation:this.uploadUrlDuringCreation}),this._upload.start()}},{key:"abort",value:function(){return this._upload?this._upload.abort():Promise.resolve()}},{key:"_handleError",value:function(e){this._retryCount<this.retryDelays.length&&this._shouldRetry?this._retryCount++,setTimeout(this.start.bind(this),this.retryDelays[this._retryCount-1]):this.onError&&this.onError(e)}},{key:"_handleSuccess",value:function(){this.onSuccess&&this.onSuccess()}}])&&s(t.prototype,n),i&&s(t,i),e}()});
